# å›½å¯†ç®—æ³• TypeScript åº“é¡¹ç›®ç»“æ„è®¾è®¡

- **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
- **æ’°å†™è§’è‰²**: å‰ç«¯å·¥ç¨‹å¸ˆ
- **é¢å‘è¯»è€…**: å¼€å‘å›¢é˜Ÿã€æ¶æ„å¸ˆã€æ–°æˆå‘˜
- **æ›´æ–°æ—¶é—´**: 2025-08-15

## 1. è®¾è®¡åŸåˆ™

### 1.1 æ ¸å¿ƒåŸåˆ™

- **å…³æ³¨ç‚¹åˆ†ç¦»**: ç®—æ³•å®ç°ã€å¹³å°é€‚é…ã€API å±‚æ¸…æ™°åˆ†ç¦»
- **å¯æµ‹è¯•æ€§**: æ¯ä¸ªæ¨¡å—éƒ½ä¾¿äºå•ç‹¬æµ‹è¯•å’ŒéªŒè¯
- **å¯æ‰©å±•æ€§**: æ”¯æŒæ–°ç®—æ³•ã€æ–°å¹³å°ã€æ–°åŠŸèƒ½çš„æ¸è¿›å¼æ·»åŠ 
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒï¼Œç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥
- **æ€§èƒ½ä¼˜åŒ–**: æ”¯æŒ Tree-shakingã€æŒ‰éœ€åŠ è½½ã€ä»£ç åˆ†å‰²
- **ç»´æŠ¤å‹å¥½**: æ¸…æ™°çš„ç›®å½•ç»“æ„ï¼Œç»Ÿä¸€çš„å‘½åè§„èŒƒ

### 1.2 æ¶æ„ç­–ç•¥

- **å•åŒ…æ¶æ„**: é¿å… monorepo å¤æ‚æ€§ï¼Œä½¿ç”¨æ¡ä»¶å¯¼å‡ºæ”¯æŒå¤šç¯å¢ƒ
- **åˆ†å±‚è®¾è®¡**: æ ¸å¿ƒå±‚ â†’ é€‚é…å±‚ â†’ API å±‚ â†’ åº”ç”¨å±‚
- **æ¨¡å—åŒ–**: æ¯ä¸ªåŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œä¾¿äºæµ‹è¯•å’Œç»´æŠ¤
- **æ¸è¿›å¼**: æ”¯æŒä»ç®€å•åˆ°å¤æ‚çš„åŠŸèƒ½æ¼”è¿›

## 2. æ•´ä½“ç›®å½•ç»“æ„

```
yggjs-gm/
â”œâ”€â”€ ğŸ“ src/                     # æºç ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“ core/               # æ ¸å¿ƒç®—æ³•å®ç°
â”‚   â”œâ”€â”€ ğŸ“ adapters/           # å¹³å°é€‚é…å™¨
â”‚   â”œâ”€â”€ ğŸ“ api/                # ç»Ÿä¸€ API å±‚
â”‚   â”œâ”€â”€ ğŸ“ utils/              # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ ğŸ“ types/              # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ ğŸ“ constants/          # å¸¸é‡å®šä¹‰
â”‚   â””â”€â”€ ğŸ“„ index.ts            # ä¸»å…¥å£æ–‡ä»¶
â”œâ”€â”€ ğŸ“ tests/                   # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“ unit/               # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ ğŸ“ integration/        # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ ğŸ“ e2e/                # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚   â”œâ”€â”€ ğŸ“ cross-lang/         # è·¨è¯­è¨€å…¼å®¹æ€§æµ‹è¯•
â”‚   â”œâ”€â”€ ğŸ“ fixtures/           # æµ‹è¯•æ•°æ®å’Œå‘é‡
â”‚   â””â”€â”€ ğŸ“ utils/              # æµ‹è¯•å·¥å…·å‡½æ•°
â”œâ”€â”€ ğŸ“ docs/                    # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“„ README.md           # é¡¹ç›®è¯´æ˜
â”‚   â”œâ”€â”€ ğŸ“„ API.md              # API æ–‡æ¡£
â”‚   â”œâ”€â”€ ğŸ“„ GUIDE.md            # ä½¿ç”¨æŒ‡å—
â”‚   â””â”€â”€ ğŸ“„ SECURITY.md         # å®‰å…¨æŒ‡å—
â”œâ”€â”€ ğŸ“ examples/                # ç¤ºä¾‹é¡¹ç›®
â”‚   â”œâ”€â”€ ğŸ“ node/               # Node.js ç¤ºä¾‹
â”‚   â”œâ”€â”€ ğŸ“ browser/            # æµè§ˆå™¨ç¤ºä¾‹
â”‚   â”œâ”€â”€ ğŸ“ react/              # React é›†æˆç¤ºä¾‹
â”‚   â””â”€â”€ ğŸ“ cross-lang/         # è·¨è¯­è¨€ç¤ºä¾‹
â”œâ”€â”€ ğŸ“ scripts/                 # æ„å»ºå’Œå·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ ğŸ“„ build.js            # æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ ğŸ“„ test.js             # æµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ ğŸ“„ benchmark.js        # æ€§èƒ½æµ‹è¯•è„šæœ¬
â”œâ”€â”€ ğŸ“ benchmarks/              # æ€§èƒ½åŸºå‡†æµ‹è¯•
â”‚   â”œâ”€â”€ ğŸ“„ sm2.bench.ts        # SM2 æ€§èƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ ğŸ“„ sm3.bench.ts        # SM3 æ€§èƒ½æµ‹è¯•
â”‚   â””â”€â”€ ğŸ“„ sm4.bench.ts        # SM4 æ€§èƒ½æµ‹è¯•
â”œâ”€â”€ ğŸ“ dist/                    # æ„å»ºè¾“å‡ºç›®å½•
â”œâ”€â”€ ğŸ“ coverage/                # æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
â”œâ”€â”€ ğŸ“ .github/                 # GitHub é…ç½®
â”‚   â”œâ”€â”€ ğŸ“ workflows/          # CI/CD å·¥ä½œæµ
â”‚   â””â”€â”€ ğŸ“„ ISSUE_TEMPLATE.md   # Issue æ¨¡æ¿
â”œâ”€â”€ ğŸ“„ package.json             # é¡¹ç›®é…ç½®
â”œâ”€â”€ ğŸ“„ tsconfig.json            # TypeScript é…ç½®
â”œâ”€â”€ ğŸ“„ tsup.config.ts           # æ„å»ºé…ç½®
â”œâ”€â”€ ğŸ“„ vitest.config.ts         # æµ‹è¯•é…ç½®
â”œâ”€â”€ ğŸ“„ eslint.config.js         # ä»£ç æ£€æŸ¥é…ç½®
â”œâ”€â”€ ğŸ“„ prettier.config.js       # ä»£ç æ ¼å¼åŒ–é…ç½®
â””â”€â”€ ğŸ“„ README.md                # é¡¹ç›®è¯´æ˜
```

## 3. æºç ç›®å½•è¯¦ç»†è®¾è®¡

### 3.1 æ ¸å¿ƒç®—æ³•å±‚ (src/core/)

```
src/core/
â”œâ”€â”€ ğŸ“ sm2/                     # SM2 æ¤­åœ†æ›²çº¿ç®—æ³•
â”‚   â”œâ”€â”€ ğŸ“„ index.ts            # SM2 æ¨¡å—å…¥å£
â”‚   â”œâ”€â”€ ğŸ“„ keypair.ts          # å¯†é’¥å¯¹ç”Ÿæˆ
â”‚   â”œâ”€â”€ ğŸ“„ sign.ts             # æ•°å­—ç­¾å
â”‚   â”œâ”€â”€ ğŸ“„ verify.ts           # ç­¾åéªŒè¯
â”‚   â”œâ”€â”€ ğŸ“„ encrypt.ts          # å…¬é’¥åŠ å¯†
â”‚   â”œâ”€â”€ ğŸ“„ decrypt.ts          # ç§é’¥è§£å¯†
â”‚   â”œâ”€â”€ ğŸ“„ curve.ts            # æ¤­åœ†æ›²çº¿å‚æ•°
â”‚   â””â”€â”€ ğŸ“„ sm2.types.ts        # SM2 ç±»å‹å®šä¹‰
â”œâ”€â”€ ğŸ“ sm3/                     # SM3 å“ˆå¸Œç®—æ³•
â”‚   â”œâ”€â”€ ğŸ“„ index.ts            # SM3 æ¨¡å—å…¥å£
â”‚   â”œâ”€â”€ ğŸ“„ digest.ts           # æ‘˜è¦ç®—æ³•
â”‚   â”œâ”€â”€ ğŸ“„ hmac.ts             # HMAC-SM3
â”‚   â”œâ”€â”€ ğŸ“„ stream.ts           # æµå¼å“ˆå¸Œ
â”‚   â””â”€â”€ ğŸ“„ sm3.types.ts        # SM3 ç±»å‹å®šä¹‰
â”œâ”€â”€ ğŸ“ sm4/                     # SM4 åˆ†ç»„å¯†ç ç®—æ³•
â”‚   â”œâ”€â”€ ğŸ“„ index.ts            # SM4 æ¨¡å—å…¥å£
â”‚   â”œâ”€â”€ ğŸ“„ cipher.ts           # æ ¸å¿ƒå¯†ç ç®—æ³•
â”‚   â”œâ”€â”€ ğŸ“„ modes.ts            # å·¥ä½œæ¨¡å¼ (ECB/CBC/CTR/CFB/OFB)
â”‚   â”œâ”€â”€ ğŸ“„ padding.ts          # å¡«å……ç®—æ³•
â”‚   â”œâ”€â”€ ğŸ“„ stream.ts           # æµå¼åŠ è§£å¯†
â”‚   â””â”€â”€ ğŸ“„ sm4.types.ts        # SM4 ç±»å‹å®šä¹‰
â”œâ”€â”€ ğŸ“ math/                    # æ•°å­¦åŸºç¡€åº“
â”‚   â”œâ”€â”€ ğŸ“„ index.ts            # æ•°å­¦åº“å…¥å£
â”‚   â”œâ”€â”€ ğŸ“„ bigint.ts           # å¤§æ•´æ•°è¿ç®—
â”‚   â”œâ”€â”€ ğŸ“„ modular.ts          # æ¨¡è¿ç®—
â”‚   â”œâ”€â”€ ğŸ“„ ecc.ts              # æ¤­åœ†æ›²çº¿è¿ç®—
â”‚   â”œâ”€â”€ ğŸ“„ random.ts           # å®‰å…¨éšæœºæ•°
â”‚   â””â”€â”€ ğŸ“„ math.types.ts       # æ•°å­¦ç±»å‹å®šä¹‰
â””â”€â”€ ğŸ“„ index.ts                 # æ ¸å¿ƒæ¨¡å—ç»Ÿä¸€å…¥å£
```

### 3.2 å¹³å°é€‚é…å±‚ (src/adapters/)

```
src/adapters/
â”œâ”€â”€ ğŸ“„ index.ts                 # é€‚é…å™¨å…¥å£
â”œâ”€â”€ ğŸ“„ runtime-detector.ts      # è¿è¡Œæ—¶æ£€æµ‹
â”œâ”€â”€ ğŸ“„ node.ts                  # Node.js é€‚é…å™¨
â”œâ”€â”€ ğŸ“„ browser.ts               # æµè§ˆå™¨é€‚é…å™¨
â”œâ”€â”€ ğŸ“„ deno.ts                  # Deno é€‚é…å™¨
â”œâ”€â”€ ğŸ“„ bun.ts                   # Bun é€‚é…å™¨
â”œâ”€â”€ ğŸ“„ react-native.ts          # React Native é€‚é…å™¨
â”œâ”€â”€ ğŸ“„ crypto-adapter.ts        # åŠ å¯† API é€‚é…
â”œâ”€â”€ ğŸ“„ buffer-adapter.ts        # Buffer å…¼å®¹å±‚
â””â”€â”€ ğŸ“„ adapters.types.ts        # é€‚é…å™¨ç±»å‹å®šä¹‰
```

### 3.3 API å±‚ (src/api/)

```
src/api/
â”œâ”€â”€ ğŸ“„ index.ts                 # API å±‚å…¥å£
â”œâ”€â”€ ğŸ“„ sm2.ts                   # SM2 é«˜çº§ API
â”œâ”€â”€ ğŸ“„ sm3.ts                   # SM3 é«˜çº§ API
â”œâ”€â”€ ğŸ“„ sm4.ts                   # SM4 é«˜çº§ API
â”œâ”€â”€ ğŸ“„ key.ts                   # å¯†é’¥ç®¡ç† API
â”œâ”€â”€ ğŸ“„ random.ts                # éšæœºæ•° API
â”œâ”€â”€ ğŸ“„ encoding.ts              # ç¼–ç è½¬æ¢ API
â””â”€â”€ ğŸ“„ api.types.ts             # API ç±»å‹å®šä¹‰
```

### 3.4 å·¥å…·å‡½æ•° (src/utils/)

```
src/utils/
â”œâ”€â”€ ğŸ“„ index.ts                 # å·¥å…·å‡½æ•°å…¥å£
â”œâ”€â”€ ğŸ“„ encoding.ts              # ç¼–ç è½¬æ¢ (hex/base64/binary)
â”œâ”€â”€ ğŸ“„ validation.ts            # è¾“å…¥éªŒè¯
â”œâ”€â”€ ğŸ“„ errors.ts                # é”™è¯¯å¤„ç†
â”œâ”€â”€ ğŸ“„ format.ts                # æ•°æ®æ ¼å¼åŒ–
â”œâ”€â”€ ğŸ“„ memory.ts                # å†…å­˜ç®¡ç†
â””â”€â”€ ğŸ“„ utils.types.ts           # å·¥å…·ç±»å‹å®šä¹‰
```

### 3.5 ç±»å‹å®šä¹‰ (src/types/)

```
src/types/
â”œâ”€â”€ ğŸ“„ index.ts                 # ç±»å‹å…¥å£
â”œâ”€â”€ ğŸ“„ algorithms.ts            # ç®—æ³•ç›¸å…³ç±»å‹
â”œâ”€â”€ ğŸ“„ keys.ts                  # å¯†é’¥ç›¸å…³ç±»å‹
â”œâ”€â”€ ğŸ“„ common.ts                # é€šç”¨ç±»å‹
â”œâ”€â”€ ğŸ“„ errors.ts                # é”™è¯¯ç±»å‹
â””â”€â”€ ğŸ“„ runtime.ts               # è¿è¡Œæ—¶ç±»å‹
```

### 3.6 å¸¸é‡å®šä¹‰ (src/constants/)

```
src/constants/
â”œâ”€â”€ ğŸ“„ index.ts                 # å¸¸é‡å…¥å£
â”œâ”€â”€ ğŸ“„ algorithms.ts            # ç®—æ³•å¸¸é‡
â”œâ”€â”€ ğŸ“„ curves.ts                # æ¤­åœ†æ›²çº¿å‚æ•°
â”œâ”€â”€ ğŸ“„ formats.ts               # æ•°æ®æ ¼å¼å¸¸é‡
â””â”€â”€ ğŸ“„ errors.ts                # é”™è¯¯ç å¸¸é‡
```

## 4. æµ‹è¯•ç›®å½•è¯¦ç»†è®¾è®¡

### 4.1 æµ‹è¯•ç»„ç»‡ç»“æ„

```
tests/
â”œâ”€â”€ ğŸ“ unit/                    # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ ğŸ“ core/               # æ ¸å¿ƒç®—æ³•æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ ğŸ“ sm2/            # SM2 ç®—æ³•æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ ğŸ“ sm3/            # SM3 ç®—æ³•æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ ğŸ“ sm4/            # SM4 ç®—æ³•æµ‹è¯•
â”‚   â”‚   â””â”€â”€ ğŸ“ math/           # æ•°å­¦åº“æµ‹è¯•
â”‚   â”œâ”€â”€ ğŸ“ adapters/           # é€‚é…å™¨æµ‹è¯•
â”‚   â”œâ”€â”€ ğŸ“ api/                # API å±‚æµ‹è¯•
â”‚   â””â”€â”€ ğŸ“ utils/              # å·¥å…·å‡½æ•°æµ‹è¯•
â”œâ”€â”€ ğŸ“ integration/             # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ ğŸ“„ sm2-workflow.test.ts # SM2 å®Œæ•´æµç¨‹æµ‹è¯•
â”‚   â”œâ”€â”€ ğŸ“„ sm3-workflow.test.ts # SM3 å®Œæ•´æµç¨‹æµ‹è¯•
â”‚   â”œâ”€â”€ ğŸ“„ sm4-workflow.test.ts # SM4 å®Œæ•´æµç¨‹æµ‹è¯•
â”‚   â””â”€â”€ ğŸ“„ cross-platform.test.ts # è·¨å¹³å°æµ‹è¯•
â”œâ”€â”€ ğŸ“ e2e/                     # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚   â”œâ”€â”€ ğŸ“ node/               # Node.js ç¯å¢ƒæµ‹è¯•
â”‚   â”œâ”€â”€ ğŸ“ browser/            # æµè§ˆå™¨ç¯å¢ƒæµ‹è¯•
â”‚   â””â”€â”€ ğŸ“ examples/           # ç¤ºä¾‹é¡¹ç›®æµ‹è¯•
â”œâ”€â”€ ğŸ“ cross-lang/              # è·¨è¯­è¨€å…¼å®¹æ€§æµ‹è¯•
â”‚   â”œâ”€â”€ ğŸ“„ python-compat.test.ts # ä¸ Python ç‰ˆæœ¬å…¼å®¹æ€§
â”‚   â”œâ”€â”€ ğŸ“„ go-compat.test.ts   # ä¸ Go ç‰ˆæœ¬å…¼å®¹æ€§
â”‚   â””â”€â”€ ğŸ“„ test-vectors.test.ts # å…±äº«æµ‹è¯•å‘é‡
â”œâ”€â”€ ğŸ“ fixtures/                # æµ‹è¯•æ•°æ®
â”‚   â”œâ”€â”€ ğŸ“„ test-vectors.json   # æ ‡å‡†æµ‹è¯•å‘é‡
â”‚   â”œâ”€â”€ ğŸ“„ keys.json           # æµ‹è¯•å¯†é’¥
â”‚   â””â”€â”€ ğŸ“„ data.json           # æµ‹è¯•æ•°æ®
â””â”€â”€ ğŸ“ utils/                   # æµ‹è¯•å·¥å…·
    â”œâ”€â”€ ğŸ“„ helpers.ts          # æµ‹è¯•è¾…åŠ©å‡½æ•°
    â”œâ”€â”€ ğŸ“„ mocks.ts            # Mock å¯¹è±¡
    â””â”€â”€ ğŸ“„ setup.ts            # æµ‹è¯•ç¯å¢ƒè®¾ç½®
```

## 5. æ–‡ä»¶å‘½åè§„èŒƒ

### 5.1 æºç æ–‡ä»¶å‘½å

- **æ¨¡å—æ–‡ä»¶**: kebab-caseï¼Œå¦‚ `sm2-sign.ts`
- **ç±»å‹æ–‡ä»¶**: `*.types.ts`ï¼Œå¦‚ `sm2.types.ts`
- **å¸¸é‡æ–‡ä»¶**: `*.constants.ts`ï¼Œå¦‚ `curves.constants.ts`
- **å…¥å£æ–‡ä»¶**: `index.ts`
- **æµ‹è¯•æ–‡ä»¶**: `*.test.ts` æˆ– `*.spec.ts`

### 5.2 ç›®å½•å‘½å

- **å…¨å°å†™**: ä½¿ç”¨å°å†™å­—æ¯å’Œè¿å­—ç¬¦
- **è¯­ä¹‰åŒ–**: ç›®å½•åèƒ½æ¸…æ™°è¡¨è¾¾å…¶ç”¨é€”
- **ç®€æ´æ€§**: é¿å…è¿‡é•¿çš„ç›®å½•å

### 5.3 å˜é‡å’Œå‡½æ•°å‘½å

```typescript
// å¸¸é‡: UPPER_SNAKE_CASE
export const SM2_CURVE_P = 0xFFFFFFFEFFFFFFFFn;

// å‡½æ•°: camelCase
export function generateKeyPair(): SM2KeyPair { }

// ç±»: PascalCase
export class SM3Hash { }

// æ¥å£: PascalCase + I å‰ç¼€
export interface ISM2Options { }

// ç±»å‹åˆ«å: PascalCase
export type SM2PrivateKey = bigint;
```
