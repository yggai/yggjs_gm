# 国密算法 TypeScript 库项目结构设计

- **文档版本**: v1.0
- **撰写角色**: 前端工程师
- **面向读者**: 开发团队、架构师、新成员
- **更新时间**: 2025-08-15

## 1. 设计原则

### 1.1 核心原则

- **关注点分离**: 算法实现、平台适配、API 层清晰分离
- **可测试性**: 每个模块都便于单独测试和验证
- **可扩展性**: 支持新算法、新平台、新功能的渐进式添加
- **类型安全**: 完整的 TypeScript 类型支持，编译时错误检查
- **性能优化**: 支持 Tree-shaking、按需加载、代码分割
- **维护友好**: 清晰的目录结构，统一的命名规范

### 1.2 架构策略

- **单包架构**: 避免 monorepo 复杂性，使用条件导出支持多环境
- **分层设计**: 核心层 → 适配层 → API 层 → 应用层
- **模块化**: 每个功能模块独立，便于测试和维护
- **渐进式**: 支持从简单到复杂的功能演进

## 2. 整体目录结构

```
yggjs-gm/
├── 📁 src/                     # 源码目录
│   ├── 📁 core/               # 核心算法实现
│   ├── 📁 adapters/           # 平台适配器
│   ├── 📁 api/                # 统一 API 层
│   ├── 📁 utils/              # 工具函数
│   ├── 📁 types/              # 类型定义
│   ├── 📁 constants/          # 常量定义
│   └── 📄 index.ts            # 主入口文件
├── 📁 tests/                   # 测试目录
│   ├── 📁 unit/               # 单元测试
│   ├── 📁 integration/        # 集成测试
│   ├── 📁 e2e/                # 端到端测试
│   ├── 📁 cross-lang/         # 跨语言兼容性测试
│   ├── 📁 fixtures/           # 测试数据和向量
│   └── 📁 utils/              # 测试工具函数
├── 📁 docs/                    # 文档目录
│   ├── 📄 README.md           # 项目说明
│   ├── 📄 API.md              # API 文档
│   ├── 📄 GUIDE.md            # 使用指南
│   └── 📄 SECURITY.md         # 安全指南
├── 📁 examples/                # 示例项目
│   ├── 📁 node/               # Node.js 示例
│   ├── 📁 browser/            # 浏览器示例
│   ├── 📁 react/              # React 集成示例
│   └── 📁 cross-lang/         # 跨语言示例
├── 📁 scripts/                 # 构建和工具脚本
│   ├── 📄 build.js            # 构建脚本
│   ├── 📄 test.js             # 测试脚本
│   └── 📄 benchmark.js        # 性能测试脚本
├── 📁 benchmarks/              # 性能基准测试
│   ├── 📄 sm2.bench.ts        # SM2 性能测试
│   ├── 📄 sm3.bench.ts        # SM3 性能测试
│   └── 📄 sm4.bench.ts        # SM4 性能测试
├── 📁 dist/                    # 构建输出目录
├── 📁 coverage/                # 测试覆盖率报告
├── 📁 .github/                 # GitHub 配置
│   ├── 📁 workflows/          # CI/CD 工作流
│   └── 📄 ISSUE_TEMPLATE.md   # Issue 模板
├── 📄 package.json             # 项目配置
├── 📄 tsconfig.json            # TypeScript 配置
├── 📄 tsup.config.ts           # 构建配置
├── 📄 vitest.config.ts         # 测试配置
├── 📄 eslint.config.js         # 代码检查配置
├── 📄 prettier.config.js       # 代码格式化配置
└── 📄 README.md                # 项目说明
```

## 3. 源码目录详细设计

### 3.1 核心算法层 (src/core/)

```
src/core/
├── 📁 sm2/                     # SM2 椭圆曲线算法
│   ├── 📄 index.ts            # SM2 模块入口
│   ├── 📄 keypair.ts          # 密钥对生成
│   ├── 📄 sign.ts             # 数字签名
│   ├── 📄 verify.ts           # 签名验证
│   ├── 📄 encrypt.ts          # 公钥加密
│   ├── 📄 decrypt.ts          # 私钥解密
│   ├── 📄 curve.ts            # 椭圆曲线参数
│   └── 📄 sm2.types.ts        # SM2 类型定义
├── 📁 sm3/                     # SM3 哈希算法
│   ├── 📄 index.ts            # SM3 模块入口
│   ├── 📄 digest.ts           # 摘要算法
│   ├── 📄 hmac.ts             # HMAC-SM3
│   ├── 📄 stream.ts           # 流式哈希
│   └── 📄 sm3.types.ts        # SM3 类型定义
├── 📁 sm4/                     # SM4 分组密码算法
│   ├── 📄 index.ts            # SM4 模块入口
│   ├── 📄 cipher.ts           # 核心密码算法
│   ├── 📄 modes.ts            # 工作模式 (ECB/CBC/CTR/CFB/OFB)
│   ├── 📄 padding.ts          # 填充算法
│   ├── 📄 stream.ts           # 流式加解密
│   └── 📄 sm4.types.ts        # SM4 类型定义
├── 📁 math/                    # 数学基础库
│   ├── 📄 index.ts            # 数学库入口
│   ├── 📄 bigint.ts           # 大整数运算
│   ├── 📄 modular.ts          # 模运算
│   ├── 📄 ecc.ts              # 椭圆曲线运算
│   ├── 📄 random.ts           # 安全随机数
│   └── 📄 math.types.ts       # 数学类型定义
└── 📄 index.ts                 # 核心模块统一入口
```

### 3.2 平台适配层 (src/adapters/)

```
src/adapters/
├── 📄 index.ts                 # 适配器入口
├── 📄 runtime-detector.ts      # 运行时检测
├── 📄 node.ts                  # Node.js 适配器
├── 📄 browser.ts               # 浏览器适配器
├── 📄 deno.ts                  # Deno 适配器
├── 📄 bun.ts                   # Bun 适配器
├── 📄 react-native.ts          # React Native 适配器
├── 📄 crypto-adapter.ts        # 加密 API 适配
├── 📄 buffer-adapter.ts        # Buffer 兼容层
└── 📄 adapters.types.ts        # 适配器类型定义
```

### 3.3 API 层 (src/api/)

```
src/api/
├── 📄 index.ts                 # API 层入口
├── 📄 sm2.ts                   # SM2 高级 API
├── 📄 sm3.ts                   # SM3 高级 API
├── 📄 sm4.ts                   # SM4 高级 API
├── 📄 key.ts                   # 密钥管理 API
├── 📄 random.ts                # 随机数 API
├── 📄 encoding.ts              # 编码转换 API
└── 📄 api.types.ts             # API 类型定义
```

### 3.4 工具函数 (src/utils/)

```
src/utils/
├── 📄 index.ts                 # 工具函数入口
├── 📄 encoding.ts              # 编码转换 (hex/base64/binary)
├── 📄 validation.ts            # 输入验证
├── 📄 errors.ts                # 错误处理
├── 📄 format.ts                # 数据格式化
├── 📄 memory.ts                # 内存管理
└── 📄 utils.types.ts           # 工具类型定义
```

### 3.5 类型定义 (src/types/)

```
src/types/
├── 📄 index.ts                 # 类型入口
├── 📄 algorithms.ts            # 算法相关类型
├── 📄 keys.ts                  # 密钥相关类型
├── 📄 common.ts                # 通用类型
├── 📄 errors.ts                # 错误类型
└── 📄 runtime.ts               # 运行时类型
```

### 3.6 常量定义 (src/constants/)

```
src/constants/
├── 📄 index.ts                 # 常量入口
├── 📄 algorithms.ts            # 算法常量
├── 📄 curves.ts                # 椭圆曲线参数
├── 📄 formats.ts               # 数据格式常量
└── 📄 errors.ts                # 错误码常量
```

## 4. 测试目录详细设计

### 4.1 测试组织结构

```
tests/
├── 📁 unit/                    # 单元测试
│   ├── 📁 core/               # 核心算法测试
│   │   ├── 📁 sm2/            # SM2 算法测试
│   │   ├── 📁 sm3/            # SM3 算法测试
│   │   ├── 📁 sm4/            # SM4 算法测试
│   │   └── 📁 math/           # 数学库测试
│   ├── 📁 adapters/           # 适配器测试
│   ├── 📁 api/                # API 层测试
│   └── 📁 utils/              # 工具函数测试
├── 📁 integration/             # 集成测试
│   ├── 📄 sm2-workflow.test.ts # SM2 完整流程测试
│   ├── 📄 sm3-workflow.test.ts # SM3 完整流程测试
│   ├── 📄 sm4-workflow.test.ts # SM4 完整流程测试
│   └── 📄 cross-platform.test.ts # 跨平台测试
├── 📁 e2e/                     # 端到端测试
│   ├── 📁 node/               # Node.js 环境测试
│   ├── 📁 browser/            # 浏览器环境测试
│   └── 📁 examples/           # 示例项目测试
├── 📁 cross-lang/              # 跨语言兼容性测试
│   ├── 📄 python-compat.test.ts # 与 Python 版本兼容性
│   ├── 📄 go-compat.test.ts   # 与 Go 版本兼容性
│   └── 📄 test-vectors.test.ts # 共享测试向量
├── 📁 fixtures/                # 测试数据
│   ├── 📄 test-vectors.json   # 标准测试向量
│   ├── 📄 keys.json           # 测试密钥
│   └── 📄 data.json           # 测试数据
└── 📁 utils/                   # 测试工具
    ├── 📄 helpers.ts          # 测试辅助函数
    ├── 📄 mocks.ts            # Mock 对象
    └── 📄 setup.ts            # 测试环境设置
```

## 5. 文件命名规范

### 5.1 源码文件命名

- **模块文件**: kebab-case，如 `sm2-sign.ts`
- **类型文件**: `*.types.ts`，如 `sm2.types.ts`
- **常量文件**: `*.constants.ts`，如 `curves.constants.ts`
- **入口文件**: `index.ts`
- **测试文件**: `*.test.ts` 或 `*.spec.ts`

### 5.2 目录命名

- **全小写**: 使用小写字母和连字符
- **语义化**: 目录名能清晰表达其用途
- **简洁性**: 避免过长的目录名

### 5.3 变量和函数命名

```typescript
// 常量: UPPER_SNAKE_CASE
export const SM2_CURVE_P = 0xFFFFFFFEFFFFFFFFn;

// 函数: camelCase
export function generateKeyPair(): SM2KeyPair { }

// 类: PascalCase
export class SM3Hash { }

// 接口: PascalCase + I 前缀
export interface ISM2Options { }

// 类型别名: PascalCase
export type SM2PrivateKey = bigint;
```
